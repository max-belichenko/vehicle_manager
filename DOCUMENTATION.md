# Vehicle Manager - Документация к API

Приложение предоставляет несколько способов развёртывания, предназначенных для демонстрации функционала.
Данные способы не предназначены для развёртывания в продуктовую среду.

В процессе создаётся пользователь `admin` с паролем `password`, имеющий полномочия администратора. 

После развёртывания (см. README.md) API доступно по адресу `http://localhost:8000/api/`.

Коллекция запросов для Postman доступна по ссылке: https://www.getpostman.com/collections/66fac36ec9fce274b348

## Аутентификация

При запросах к API применяется базовая аутентификация по логину и паролю.
Учётные данные необходимо передавать в заголовке: `Authorization: Basic <base64 encoded credentials>'`.


### POST /api/vehicles/

Создаёт новую запись о ТС.

Информация передаётся в payload в следующем формате:

```
{
    "make": <Марка: str>,
    "model": <Модель: str>,
    "color": <Цвет: str>,
    "registration_number": <Регистрационный номер: str>,
    "year_of_manufacture": <Год выпуска: int>,
    "vin": <VIN: str>,
    "vehicle_certificate_number": <Номер СТС: str>,
    "vehicle_certificate_date": <Дата выдачи СТС: date>
}
```

При этом у некоторых полей есть ряд ограничений.

- Регистрационный номер должен быть уникальным;
- Год выпуска не должен превышать текущий год;
- VIN должен содержать ровно 17 символов, а также должен быть уникальным;


### PATCH /api/vehicles/<int:pk>/

Редактирует существующую запись о ТС.

Формат данных и ограничения аналогичны запросу `POST /api/vehicles/`.


### DELETE /api/vehicles/<int:pk>/

Удаляет существующую запись о ТС.


### GET /api/vehicles/

Возвращает список ТС.

Возможен поиск по следующим полям, значения которых передаются в качестве параметров запроса:
- make  ('Марка')
- model  ('Модель')
- color  ('Цвет')
- registration_number  ('Регистрационный номер')
- year_of_manufacture  ('Год выпуска')
- vin  ('VIN')
- vehicle_certificate_number  ('Номер СТС')
- vehicle_certificate_date  ('Дата выдачи СТС')


### GET /api/vehicles/<int:pk>/

Возвращает данные о ТС с указанным идентификатором.


### PUT /api/vehicles/import/

Импортирует данные о ТС из прикреплённого файла.

Поддерживаются форматы файлов: xls, xlsx и csv.

При передаче файла требуется указать имя файла и его тип в соответствующих заголовках.

Формат файла идентифицируется по содержимому заголовка `Content-Type`:
- `text/csv` для .csv;
- `application/vnd.ms-excel` для .xls;
- `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet` для xlsx.

Имя файла указывается в заголовке `Content-Disposition` в формате: `attachment; filename=<filename>`

Передаваемый файл (независимо от формата) должен содержать заголовки в первой строке:
Марка, Модель, Цвет, Регистрационный номер, Год выпуска, VIN, Номер СТС, Дата выдачи СТС.
Требования к данным применяются аналогичные запросу `POST /api/vehicles/`.

**Примечание:** В каталоге `data` представлены готовые примеры файлов для импорта.


### GET /api/vehicles/export/

Экспортирует данные о ТС в файл.

Доступна фильтрация данных - работает аналогично запросу `GET /api/vehicles/`.

Поддерживаются форматы файлов: xlsx и csv.

Требуемый формат выгрузки идентифицируется по содержимому заголовка `Accept`:
- `text/csv` для .csv;
- `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet` для xlsx.

Выгружаются следующие поля данных о ТС:
Марка, Модель, Цвет, Регистрационный номер, Год выпуска, VIN, Номер СТС, Дата выдачи СТС.


### GET /api/logs/

Возвращает журнал изменения данных о ТС.

**Примечание:** При каждом добавлении, изменении или удалении записи о ТС в журнал вносится соответствующая запись.
Данный журнал доступен только для пользователей уровня "Администратор". 